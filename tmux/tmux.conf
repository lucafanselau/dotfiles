# ============================================
# Tmux Configuration - Better Multi-Pane Workflow
# ============================================

# -------------------------------------------
# Mouse Support (Click to select panes!)
# -------------------------------------------
set -g mouse on

# -------------------------------------------
# Better Prefix (Ctrl+a is easier than Ctrl+b)
# -------------------------------------------
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# -------------------------------------------
# Pane Navigation - Vim-style with prefix
# -------------------------------------------
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt + arrow keys (no prefix needed!)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# -------------------------------------------
# Pane Resizing
# -------------------------------------------
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# -------------------------------------------
# Split Panes (more intuitive keys)
# -------------------------------------------
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# -------------------------------------------
# Scrollback & Copy Mode
# -------------------------------------------
set -g history-limit 50000

# Enter copy mode with prefix + [
# Use vi keys in copy mode
setw -g mode-keys vi

# v to start selection, y to copy (like vim)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Mouse scroll enters copy mode automatically
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# -------------------------------------------
# Window Navigation
# -------------------------------------------
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# -------------------------------------------
# Quality of Life
# -------------------------------------------
# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Faster escape time (important for vim users)
set -sg escape-time 0

# Reload config easily
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# -------------------------------------------
# Visual Improvements
# -------------------------------------------
# Highlight active pane
set -g pane-active-border-style 'fg=cyan'
set -g pane-border-style 'fg=colour238'

# Status bar
set -g status-style 'bg=colour235 fg=colour255'
set -g status-left '#[fg=cyan,bold] #S '
set -g status-right '#[fg=colour245] %H:%M '

# -------------------------------------------
# Clipboard integration
# -------------------------------------------
# Allow OSC 52 to pass through tmux to the terminal.
# This lets Neovim (over SSH) yank directly to your local clipboard.
set -g set-clipboard on
set -g allow-passthrough on

# Copy to system clipboard (local macOS fallback)
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
